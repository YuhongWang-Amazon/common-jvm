# Blob/object storage.

load("//build:defs.bzl", "test_target")
load("@io_bazel_rules_kotlin//kotlin:kotlin.bzl", "kt_jvm_library")

kt_jvm_library(
    name = "client",
    srcs = ["StorageClient.kt"],
    visibility = ["//visibility:public"],
    deps = [
        "//imports/java/com/google/protobuf",
        "//imports/kotlin/kotlinx/coroutines:core",
        "//src/main/kotlin/org/wfanet/measurement/common",
    ],
)

package_group(
    name = "metric_values_service",
    packages = [
        "//src/main/kotlin/org/wfanet/measurement/duchy/service/internal/metricvalues/...",
        "//src/test/kotlin/org/wfanet/measurement/duchy/service/internal/metricvalues/...",
    ],
)

kt_jvm_library(
    name = "metric_value_store",
    srcs = ["MetricValueStore.kt"],
    visibility = [
        test_target(":__pkg__"),
        ":metric_values_service",
    ],
    exports = ["//src/main/kotlin/org/wfanet/measurement/storage:client"],
    deps = [
        ":client",
        "//imports/kotlin/kotlinx/coroutines:core",
    ],
)

package_group(
    name = "duchy_computations",
    packages = [
        "//src/main/kotlin/org/wfanet/measurement/duchy/daemon/mill/...",
        "//src/main/kotlin/org/wfanet/measurement/duchy/service/...",
        "//src/main/kotlin/org/wfanet/measurement/service/internal/duchy/computation/control/...",
        "//src/test/kotlin/org/wfanet/measurement/duchy/daemon/mill/...",
        "//src/test/kotlin/org/wfanet/measurement/duchy/mill/...",
        "//src/test/kotlin/org/wfanet/measurement/duchy/service/...",
    ],
)

# TODO(b/164480460): Remove once db package is no longer referencing storage package.
package_group(
    name = "computation_db",
    packages = [
        "//src/main/kotlin/org/wfanet/measurement/db/duchy/computation/...",
        "//src/test/kotlin/org/wfanet/measurement/db/duchy/computation/...",
    ],
)

kt_jvm_library(
    name = "computation_store",
    srcs = ["ComputationStore.kt"],
    visibility = [
        ":computation_db",
        ":duchy_computations",
        "//src:integration_testing",
    ],
    exports = ["//src/main/kotlin/org/wfanet/measurement/storage:client"],
    deps = [
        ":client",
        "//src/main/kotlin/org/wfanet/measurement/duchy:computation_stage",
        "//src/main/proto/wfa/measurement/internal/duchy:computation_token_java_proto",
    ],
)
